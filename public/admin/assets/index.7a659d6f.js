import{h as c,au as d,at as r,r as p,j as e,H as x,B as o,a as s,bb as B,F as _,bc as b}from"./index.d7da5add.js";import{U as D}from"./index.0d353d2a.js";import{C as F}from"./index.bfb3086e.js";import{D as E,P as I}from"./index.e01d1b69.js";import{i as y,C as v,D as w}from"./use-immer.module.58dd9b11.js";import"./index.c9b1fb52.js";import{c as g}from"./convertNullToUndefined.a19d8223.js";import{I as A}from"./image.22b6a232.js";import{I as L}from"./index.9fa425d5.js";import"./index.08b14342.js";import"./index.d1d405b6.js";import"./index.a68f64a6.js";import"./index.e049f78f.js";import"./index.7c59ebec.js";function j(t){return c.post("/api/team/query",t)}function k(t){return c.post("/api/team/detail",t)}function S(t){return c.post("/api/team/create",t)}function q(t){return c.post("/api/team/update",t)}function z(t){return c.post("/api/team/delete",t)}const N=d.TextArea;function P(t){const[u]=r.useForm(),[n,m]=p.exports.useState(!1);async function f(){u.validate().then(async i=>{m(!0);const a=g(i);try{const l={...a,profile_image:a.profile_image&&a.profile_image.length!==0?a.profile_image[0].response.data.name:void 0,detail_images:a.detail_images&&a.detail_images.length!==0?JSON.stringify(a.detail_images.map(C=>C.response.data.name)):void 0,status:a.status?"true":"false",sort_index:a.sort_index===0?void 0:a.sort_index};let h;t.data?h=await q({...l,uuid:t.data.uuid}):h=await S(l),h.code===0&&(t.reload(),t.close())}finally{m(!1)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return p.exports.useEffect(()=>{if(t.data){const i=g(t.data),a=i.profile_image;u.setFieldsValue({...i,profile_image:i.profile_image?[{uid:i.profile_image,url:a,response:{data:{name:i.profile_image.replace("/media/image?n=",""),path:i.profile_image}}}]:[],sort_index:i.sort_index?i.sort_index:void 0,joined_date:i.joined_date?new Date(i.joined_date):void 0})}},[t.data]),p.exports.useEffect(()=>{t.visible===!1&&u.resetFields()},[u,t.visible]),e(F,{title:t.data?"\u4FEE\u6539\u6210\u5458":"\u521B\u5EFA\u6210\u5458",extra:e(x,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[e(o,{type:"default",onClick:()=>t.close(),children:"\u53D6\u6D88"},"cancel"),e(o,{type:"primary",loading:n,onClick:f,children:t.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:s(r,{form:u,labelCol:{span:2},wrapperCol:{span:22},children:[e(r.Item,{label:"\u6210\u5458\u540D\u5B57",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u5B57"}],children:e(d,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u5B57"})}),e(r.Item,{label:"\u6210\u5458\u804C\u4F4D",field:"job_title",children:e(d,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u804C\u4F4D"})}),e(r.Item,{label:"\u6210\u5458\u5934\u50CF",field:"profile_image",triggerPropName:"fileList",children:e(D,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(r.Item,{label:"\u6210\u5458\u7B80\u4ECB",field:"introduction",children:e(N,{maxLength:200,placeholder:"\u6210\u5458\u7B80\u4ECB",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(r.Item,{label:"\u6210\u5458\u624B\u673A\u53F7",field:"phone",children:e(d,{maxLength:100,showWordLimit:!0,placeholder:"\u6210\u5458\u624B\u673A\u53F7"})}),e(r.Item,{label:"\u6210\u5458\u90AE\u7BB1",field:"email",rules:[{validator(i,a){i&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(i)&&a("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E")}}],children:e(d,{maxLength:100,showWordLimit:!0,placeholder:"\u6210\u5458\u90AE\u7BB1"})}),e(r.Item,{label:"\u5165\u804C\u65F6\u95F4",field:"joined_date",wrapperCol:{span:2},children:e(E,{})}),e(r.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},children:e(B,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u6392\u5E8F"})})]})})}function X(){const t=p.exports.useRef(),[u,n]=y({visible:!1,close:function(){n(i=>{i.visible=!1})}});async function m(i){try{const a=await k({uuid:i});a.code===0&&n(l=>{l.data=a.data,l.visible=!0})}catch{}}const f=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u540D\u5B57",dataIndex:"name",ellipsis:!0},{title:"\u5934\u50CF",width:150,dataIndex:"profile_image",render:(i,a)=>{if(a.profile_image){let l="";return l=a.profile_image,e(A,{width:40,height:40,src:l})}else return"\u6682\u65E0\u5934\u50CF"}},{title:"\u804C\u4F4D",dataIndex:"job_title"},{title:"\u4ECB\u7ECD",dataIndex:"introduction",ellipsis:!0},{title:"\u90AE\u7BB1",dataIndex:"email",ellipsis:!0},{title:"\u624B\u673A\u53F7",dataIndex:"phone"},{title:"\u5165\u804C\u65F6\u95F4",dataIndex:"joined_date"},{title:"\u64CD\u4F5C",width:280,render:(i,a)=>s(v,{children:[s(o,{type:"text",onClick:()=>m(a.uuid),children:[e(b,{}),"\u7F16\u8F91"]}),e(w,{reqDel:z,params:{uuid:a.uuid},reload:()=>t.current.reload(),children:s(o,{type:"text",children:[e(L,{}),"\u5220\u9664"]})})]})}];return s(_,{children:[u.visible&&e(P,{visible:u.visible,data:u.data,close:()=>u.close(),reload:()=>t.current.reload()}),e(F,{style:{display:u.visible?"none":void 0},children:e(I,{ref:t,request:j,columns:f,actionBarRender:[e(o,{type:"primary",onClick:()=>t.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[e(o,{type:"primary",onClick:()=>{n(i=>{i.visible=!0,i.data=void 0})},children:"\u521B\u5EFA\u6210\u5458"},"create")]})})]})}export{X as default};
