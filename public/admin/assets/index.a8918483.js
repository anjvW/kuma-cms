import{h as d,at as n,r as m,j as a,H as h,B as o,a as s,au as f,ba as v,M as F,F as C,bc as E}from"./index.f83d85b5.js";import{U as y}from"./index.bea412e5.js";import{C as g}from"./index.0d3d33cd.js";import{D as B,P as b}from"./index.74329099.js";import{i as x,C as I,D as w}from"./use-immer.module.1c8e9420.js";import"./index.ffb2a7b6.js";import{c as D}from"./convertNullToUndefined.a19d8223.js";import{f as k}from"./formatDate.c584a859.js";import{M as _}from"./index.20a4d813.js";import{I as q}from"./image.a7df5067.js";import{I as L}from"./index.f46d4afd.js";import"./index.289dc640.js";import"./index.92a955e0.js";import"./index.d3875766.js";import"./index.dbc23ec2.js";import"./index.03083615.js";function P(e){return d.post("/api/event/query",e)}function j(e){return d.post("/api/event/detail",e)}function M(e){return d.post("/api/event/create",e)}function N(e){return d.post("/api/event/update",e)}function S(e){return d.post("/api/event/delete",e)}function A(e){const[r]=n.useForm(),[l,c]=m.exports.useState(!1);async function p(){r.validate().then(async t=>{c(!0);try{const i={...t,image:t.image&&t.image.length!==0?t.image[0].response.data.name:void 0};let u;e.data?u=await N({...i,uuid:e.data.uuid}):u=await M(i),u.code===0&&(e.reload(),e.close())}finally{c(!1)}}).catch(t=>{if(t.errors)for(const i in t.errors)F.error(t.errors[i].message)})}return m.exports.useEffect(()=>{if(e.data){const t=D(e.data),i=t.image;r.setFieldsValue({...t,image:t.image?[{uid:t.image,url:i,response:{data:{name:t.image.replace("/media/image?n=",""),path:t.image}}}]:[],event_date:t.event_date?k(new Date(t.event_date)):void 0})}},[e.data]),m.exports.useEffect(()=>{e.visible===!1&&r.resetFields()},[r,e.visible]),a(g,{title:e.data?"\u4FEE\u6539\u4E8B\u4EF6":"\u521B\u5EFA\u4E8B\u4EF6",extra:a(h,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[a(o,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),a(o,{type:"primary",loading:l,onClick:p,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:s(n,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[a(n.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:a(f,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),a(n.Item,{label:"\u7167\u7247",field:"image",triggerPropName:"fileList",children:a(y,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),a(n.Item,{label:"\u5206\u7EC4",field:"group",wrapperCol:{span:2},children:a(f,{maxLength:100,placeholder:"\u5206\u7EC4"})}),a(n.Item,{label:"\u65F6\u95F4",field:"event_date",wrapperCol:{span:2},children:a(B,{})}),a(v,{orientation:"left",children:"\u6B63\u6587"}),a(n.Item,{field:"description",wrapperCol:{span:24},triggerPropName:"html",trigger:"getContent",rules:[{required:!0},{validator(t,i){if(t==="<p><br></p>")return i("\u8BF7\u8F93\u5165\u6B63\u6587");i()}}],children:a(_,{})})]})})}function ee(){const e=m.exports.useRef(),[r,l]=x({visible:!1,close:function(){l(t=>{t.visible=!1})}});async function c(t){try{const i=await j({uuid:t});i.code===0&&l(u=>{u.data=i.data,u.visible=!0})}catch{}}const p=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u6807\u9898",dataIndex:"title",ellipsis:!0},{title:"\u56FE\u7247",width:150,dataIndex:"image",render:(t,i)=>{if(i.image){let u="";return u=i.image,a(q,{width:40,height:40,src:u})}else return"\u6682\u65E0\u56FE\u7247"}},{title:"\u5206\u7EC4",dataIndex:"group"},{title:"\u4E8B\u4EF6\u65E5\u671F",dataIndex:"event_date"},{title:"\u64CD\u4F5C",width:280,render:(t,i)=>s(I,{children:[s(o,{type:"text",onClick:()=>c(i.uuid),children:[a(E,{}),"\u7F16\u8F91"]}),a(w,{reqDel:S,params:{uuid:i.uuid},reload:()=>e.current.reload(),children:s(o,{type:"text",children:[a(L,{}),"\u5220\u9664"]})})]})}];return s(C,{children:[r.visible&&a(A,{visible:r.visible,data:r.data,close:()=>r.close(),reload:()=>e.current.reload()}),a(g,{style:{display:r.visible?"none":void 0},children:a(b,{ref:e,request:P,columns:p,actionBarRender:[a(o,{type:"primary",onClick:()=>e.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[a(o,{type:"primary",onClick:()=>{l(t=>{t.visible=!0,t.data=void 0})},children:"\u8BB0\u5F55\u4E8B\u4EF6"},"create")]})})]})}export{ee as default};
