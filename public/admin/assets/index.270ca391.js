import{au as b,at as n,r as m,a as p,j as e,H as D,B as g,ba as x,an as S,b9 as A,F as L,bb as O}from"./index.17afa57a.js";import{T as v}from"./index.70b46f9a.js";import{U as I,I as T}from"./index.1c80a89c.js";import{C as _}from"./index.78af0889.js";import{T as N,P as q}from"./index.b31c21f2.js";import{b as k,u as P,e as j,p as J,f as M,g as R,r as W,h as z}from"./index.0b1b6d31.js";import{i as H,C as U,D as G}from"./use-immer.module.275c8cce.js";import"./index.ba74eecf.js";import{M as V}from"./index.720fa79a.js";import{I as K}from"./image.0c93b1fb.js";import{I as Q}from"./index.5331a58d.js";import{I as X}from"./index.e9f70ed9.js";import"./index.7f0e34d3.js";import"./index.7ec2cf08.js";import"./index.2739d5bf.js";import"./index.10dfb9a6.js";const w=b.TextArea;function Y(a){const[h]=n.useForm(),[f,d]=m.exports.useState(""),[C,E]=m.exports.useState(!1),[y,B]=m.exports.useState([]);async function u(){try{const t=await k();if(t.code===0){const c=t.data.pageData,l=new Map,i=[];c.forEach(s=>l.set(s.id,{...s,children:[]})),c.forEach(s=>{const F=l.get(s.pid);F?F.children.push(l.get(s.id)):i.push(l.get(s.id))}),B(i)}}catch{}}function r(t){d(t)}async function o(){h.validate().then(async t=>{E(!0);try{if(!f||f==="<p><br></p>")throw new Error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9");const c={...t,cover_image:t.cover_image&&t.cover_image.length!==0?t.cover_image[0].response.data.name:void 0,detail_images:t.detail_images&&t.detail_images.length!==0?JSON.stringify(t.detail_images.map(i=>i.response.data.name)):void 0,status:t.status?"true":"false",description:f};let l;a.data?l=await P({...c,uuid:a.data.uuid}):l=await j(c),l.code===0&&(a.reload(),a.close())}finally{E(!1)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return m.exports.useEffect(()=>{u()},[]),m.exports.useEffect(()=>{if(a.data){const t=a.data,c=t.cover_image;h.setFieldsValue({...t,cover_image:t.cover_image?[{uid:t.cover_image,url:c,response:{data:{name:t.cover_image.replace("/media/image?n=",""),path:t.cover_image}}}]:[],detail_images:JSON.parse(t.detail_images).map((l,i)=>({uid:i,url:l,response:{data:{name:l.replace("/media/image?n=",""),path:l}}}))}),d(a.data.description)}},[a.data]),m.exports.useEffect(()=>{a.visible===!1&&h.resetFields()},[h,a.visible]),p(_,{title:a.data?"\u4FEE\u6539\u4EA7\u54C1":"\u521B\u5EFA\u4EA7\u54C1",extra:e(D,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>a.close()}),actions:[e(g,{type:"default",onClick:()=>a.close(),children:"\u53D6\u6D88"},"cancel"),e(g,{type:"primary",loading:C,onClick:o,children:a.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:[p(n,{form:h,labelCol:{span:2},wrapperCol:{span:22},children:[e(n.Item,{label:"\u4EA7\u54C1\u540D\u79F0",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u540D\u79F0"}],children:e(b,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u540D\u79F0"})}),e(n.Item,{label:"\u5206\u7C7B",field:"cid",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B"}],wrapperCol:{span:10},children:e(N,{treeData:y,fieldNames:{key:"id",title:"name"},allowClear:!0})}),e(n.Item,{label:"\u6587\u7AE0\u5C01\u9762",field:"cover_image",triggerPropName:"fileList",children:e(I,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(n.Item,{label:"\u4EA7\u54C1\u56FE\u7247",field:"detail_images",triggerPropName:"fileList",children:e(I,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card"})}),e(n.Item,{label:"SEO\u6807\u9898",field:"seo_title",children:e(b,{maxLength:200,showWordLimit:!0,placeholder:"SEO\u6807\u9898"})}),e(n.Item,{label:"SEO\u63CF\u8FF0",field:"seo_desc",children:e(w,{maxLength:200,placeholder:"SEO\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(n.Item,{label:"SEO\u5173\u952E\u8BCD",field:"seo_keywords",children:e(w,{maxLength:200,placeholder:"SEO\u5173\u952E\u8BCD",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(n.Item,{label:"\u4EF7\u683C",field:"price",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u4EF7\u683C"}],wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,placeholder:"\u4EF7\u683C",precision:2})}),e(n.Item,{label:"\u5E93\u5B58",field:"stock_quantity",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u5E93\u5B58"}],wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u5E93\u5B58"})}),e(n.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u6392\u5E8F"})}),e(n.Item,{label:"\u5546\u54C1\u72B6\u6001",field:"status",triggerPropName:"checked",children:e(S,{})})]}),e(A,{orientation:"left",children:"\u4EA7\u54C1\u63CF\u8FF0"}),e(V,{html:f,getContent:r})]})}function ge(){const a=m.exports.useRef(),[h,f]=m.exports.useState([]),[d,C]=H({visible:!1,close:function(){C(u=>{u.visible=!1})}});async function E(u){const o=(await k()).data.pageData,t=new Map,c=[];return o.forEach(i=>t.set(i.id,{...i,children:[]})),o.forEach(i=>{const s=t.get(i.pid);s?s.children.push(t.get(i.id)):c.push(t.get(i.id))}),f(c),u.map(i=>{const s=o.find(F=>F.id===i.cid);return{...i,category:s?s.name:null}})}async function y(u){try{const r=await z({uuid:u});r.code===0&&C(o=>{o.data=r.data,o.visible=!0})}catch{}}const B=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u5206\u7C7B",dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:h,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:"\u6807\u9898",dataIndex:"name",ellipsis:!0},{title:"\u5C01\u9762\u56FE\u7247",width:150,dataIndex:"cover_image",render:(u,r)=>{if(r.cover_image){let o="";return o=r.cover_image,e(K,{width:40,height:40,src:o})}else return"\u6682\u65E0\u5C01\u9762"}},{title:"\u5206\u7C7B",dataIndex:"category"},{title:"\u4EF7\u683C",dataIndex:"price"},{title:"\u5E93\u5B58",dataIndex:"stock_quantity"},{title:"\u6D4F\u89C8\u91CF",dataIndex:"view_count"},{title:"\u5546\u54C1\u72B6\u6001",dataIndex:"is_published",render(u,r){return r.status===1?e(v,{color:"green",children:"\u5DF2\u4E0A\u67B6"}):e(v,{color:"red",children:"\u5DF2\u4E0B\u67B6"})}},{title:"\u66F4\u65B0\u65F6\u95F4",width:180,dataIndex:"updated_at"},{title:"\u64CD\u4F5C",width:280,render:(u,r)=>p(U,{children:[p(g,{type:"text",onClick:()=>y(r.uuid),children:[e(O,{}),"\u7F16\u8F91"]}),r.status===0?p(g,{type:"text",onClick:async()=>{(await M(r.uuid)).code===0&&a.current.reload()},children:[e(T,{}),"\u4E0A\u67B6"]}):p(g,{type:"text",onClick:async()=>{(await R(r.uuid)).code===0&&a.current.reload()},children:[e(Q,{}),"\u4E0B\u67B6"]}),e(G,{reqDel:W,params:{uuid:r.uuid},reload:()=>a.current.reload(),children:p(g,{type:"text",children:[e(X,{}),"\u5220\u9664"]})})]})}];return p(L,{children:[d.visible&&e(Y,{visible:d.visible,data:d.data,close:()=>d.close(),reload:()=>a.current.reload()}),e(_,{style:{display:d.visible?"none":void 0},children:e(q,{ref:a,request:J,columns:B,dataRender:E,actionBarRender:[e(g,{type:"primary",onClick:()=>a.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[e(g,{type:"primary",onClick:()=>{C(u=>{u.visible=!0,u.data=void 0})},children:"\u521B\u5EFA\u4EA7\u54C1"},"create")]})})]})}export{ge as default};
