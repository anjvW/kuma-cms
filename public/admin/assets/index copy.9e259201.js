import{a5 as n,al as a,r as c,j as u,F as m,aG as _,a as h,aB as y,an as A,aC as D,ao as g}from"./index.fb3b045d.js";import{S as p,U as I,M as L,c as S}from"./index.058d1b43.js";import{S as j}from"./index.598034f9.js";import"./index.ef35ada2.js";import"./index.96cd2cf9.js";const{Row:q,Col:b}=A,k=n.TextArea;function N(e){const[l]=a.useForm(),[f,v]=c.exports.useState(""),[C,E]=c.exports.useState(!1);c.exports.useEffect(()=>{if(e.uuid&&!e.loading){const{title:i,author:t,source:o,description:d,is_publish:F,cover_pic:r,file_url:s}=e.detail;l.setFieldsValue({title:i,author:t,source:o,description:d,is_publish:F,cover_pic:[{uid:r,url:s,response:{data:{image:{gid:r}}}}]})}},[e.uuid,e.loading]),c.exports.useEffect(()=>{e.visible===!1&&l.resetFields()},[e.visible]);function B(i){v(i)}async function w(i){E(!0);try{const t=await S(i);if(t.code===0)g.success("\u7F16\u8F91\u6210\u529F"),e.close(),e.tableResert();else throw new Error(t.message)}catch(t){g.error(t.message)}E(!1)}async function x(){l.validate().then(()=>{try{if(f==="<p><br></p>")throw new Error("\u8BF7\u586B\u5199\u5C97\u4F4D\u9700\u6C42");const{title:i,author:t,source:o,description:d,is_publish:F,cover_pic:r}=l.getFieldsValue();let s;try{D(r)&&(s=r[0].response.data.image.gid)}catch{throw new Error("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25,\u8BF7\u91CD\u65B0\u4E0A\u4F20")}w({uuid:e.uuid,title:i,author:t,source:o,description:d,is_publish:F,cover_pic:s,content:f})}catch(i){g.error(i.message)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return u(m,{children:u(_,{width:"100%",visible:e.visible,maskClosable:!1,onCancel:()=>e.close(),okText:e.uuid?"\u4FEE\u6539":"\u521B\u5EFA",confirmLoading:C,onOk:x,children:e.loading?u(p,{text:{rows:10}}):h(m,{children:[u(a,{form:l,labelCol:{span:4},children:h(q,{gutter:24,align:"center",children:[h(b,{span:18,children:[u(a.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:u(n,{maxLength:200,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),u(a.Item,{label:"\u4F5C\u8005",field:"author",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F5C\u8005"}],children:u(n,{maxLength:20,placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"})}),u(a.Item,{label:"\u6765\u6E90",field:"source",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6765\u6E90"}],children:u(n,{maxLength:50,placeholder:"\u8BF7\u8F93\u5165\u6765\u6E90"})}),u(a.Item,{label:"\u63CF\u8FF0",field:"description",children:u(k,{maxLength:200,placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0",autoSize:!0})}),u(a.Item,{label:"\u662F\u5426\u53D1\u5E03",field:"is_publish",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u662F\u5426\u53D1\u5E03"}],children:u(j,{options:[{label:"\u662F",value:"0"},{label:"\u5426",value:"1"}]})})]}),u(b,{span:6,children:e.visible&&u(a.Item,{label:"\u6587\u7AE0\u5C01\u9762",layout:"vertical",field:"cover_pic",rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5C01\u9762\u56FE"}],children:u(I,{defaultFileList:e.uuid?[{uid:e.detail.cover_pic,url:e.detail.file_url}]:void 0,action:"/api/upload/image",imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})})})]})}),u(y,{orientation:"left",children:"\u6B63\u6587"}),e.visible&&u(m,{children:u(L,{html:e.uuid?e.detail.content:"",getNewHtml:B})})]})})})}export{N as default};
