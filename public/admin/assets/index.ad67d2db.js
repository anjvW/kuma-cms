import{h as d,au as f,at as n,r as m,j as a,H as h,B as l,a as s,M as F,F as v,bc as C}from"./index.1e29877d.js";import{U as E}from"./index.bbee8227.js";import{C as g}from"./index.869d7a2d.js";import{D as y,P as x}from"./index.5d086ab8.js";import{i as b,C as I,D as B}from"./use-immer.module.11dbde33.js";import"./index.34bccf16.js";import{c as w}from"./convertNullToUndefined.a19d8223.js";import{f as D}from"./formatDate.c584a859.js";import{I as k}from"./image.0a94c793.js";import{I as L}from"./index.a5f7f2c5.js";import"./index.bd4ad876.js";import"./index.c248c048.js";import"./index.5842d0ef.js";import"./index.e05c3db1.js";import"./index.3dd936b3.js";function _(e){return d.post("/api/event/query",e)}function A(e){return d.post("/api/event/detail",e)}function j(e){return d.post("/api/event/create",e)}function q(e){return d.post("/api/event/update",e)}function P(e){return d.post("/api/event/delete",e)}const S=f.TextArea;function T(e){const[r]=n.useForm(),[o,c]=m.exports.useState(!1);async function p(){r.validate().then(async t=>{c(!0);try{const i={...t,image:t.image&&t.image.length!==0?t.image[0].response.data.name:void 0};let u;e.data?u=await q({...i,uuid:e.data.uuid}):u=await j(i),u.code===0&&(e.reload(),e.close())}finally{c(!1)}}).catch(t=>{if(t.errors)for(const i in t.errors)F.error(t.errors[i].message)})}return m.exports.useEffect(()=>{if(e.data){const t=w(e.data),i=t.image;r.setFieldsValue({...t,image:t.image?[{uid:t.image,url:i,response:{data:{name:t.image.replace("/media/image?n=",""),path:t.image}}}]:[],event_date:t.event_date?D(new Date(t.event_date)):void 0})}},[e.data]),m.exports.useEffect(()=>{e.visible===!1&&r.resetFields()},[r,e.visible]),a(g,{title:e.data?"\u4FEE\u6539\u4E8B\u4EF6":"\u521B\u5EFA\u4E8B\u4EF6",extra:a(h,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[a(l,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),a(l,{type:"primary",loading:o,onClick:p,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:s(n,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[a(n.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:a(f,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),a(n.Item,{label:"\u56FE\u7247",field:"image",triggerPropName:"fileList",children:a(E,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),a(n.Item,{label:"\u5206\u7EC4",field:"group",wrapperCol:{span:2},children:a(f,{maxLength:100,placeholder:"\u5206\u7EC4"})}),a(n.Item,{label:"\u65F6\u95F4",field:"event_date",wrapperCol:{span:2},children:a(y,{})}),a(n.Item,{label:"\u63CF\u8FF0",field:"description",children:a(S,{maxLength:200,placeholder:"\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function Z(){const e=m.exports.useRef(),[r,o]=b({visible:!1,close:function(){o(t=>{t.visible=!1})}});async function c(t){try{const i=await A({uuid:t});i.code===0&&o(u=>{u.data=i.data,u.visible=!0})}catch{}}const p=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u6807\u9898",dataIndex:"title",ellipsis:!0},{title:"\u56FE\u7247",width:150,dataIndex:"image",render:(t,i)=>{if(i.image){let u="";return u=i.image,a(k,{width:40,height:40,src:u})}else return"\u6682\u65E0\u56FE\u7247"}},{title:"\u5206\u7EC4",dataIndex:"group"},{title:"\u4E8B\u4EF6\u65E5\u671F",dataIndex:"event_date"},{title:"\u64CD\u4F5C",width:280,render:(t,i)=>s(I,{children:[s(l,{type:"text",onClick:()=>c(i.uuid),children:[a(C,{}),"\u7F16\u8F91"]}),a(B,{reqDel:P,params:{uuid:i.uuid},reload:()=>e.current.reload(),children:s(l,{type:"text",children:[a(L,{}),"\u5220\u9664"]})})]})}];return s(v,{children:[r.visible&&a(T,{visible:r.visible,data:r.data,close:()=>r.close(),reload:()=>e.current.reload()}),a(g,{style:{display:r.visible?"none":void 0},children:a(x,{ref:e,request:_,columns:p,actionBarRender:[a(l,{type:"primary",onClick:()=>e.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[a(l,{type:"primary",onClick:()=>{o(t=>{t.visible=!0,t.data=void 0})},children:"\u521B\u5EFA\u4E8B\u4EF6"},"create")]})})]})}export{Z as default};
