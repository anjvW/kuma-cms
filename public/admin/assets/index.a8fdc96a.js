import{h as F,au as f,at as r,r as c,j as t,H as C,B as d,a as p,b2 as x,an as B,F as E,b3 as b}from"./index.bac24274.js";import{U as y}from"./index.7d445636.js";import{C as g}from"./index.96dceb81.js";import{P as I}from"./index.32515e9c.js";import{i as v,C as k,D as _}from"./use-immer.module.0eaeb26c.js";import{a as w}from"./index.3cbcf652.js";import"./index.b77563ad.js";import{c as L}from"./convertNullToUndefined.a19d8223.js";import{t as D}from"./index.8e774c83.js";import{I as S}from"./image.f9379367.js";import{I as A}from"./index.a4faf4c6.js";import"./index.e2a733aa.js";import"./index.1d0f5987.js";import"./index.8c043a06.js";import"./index.1b69fff7.js";function N(e){return F.post("/api/link/query",e)}function T(e){return F.post("/api/team/detail",e)}function j(e){return F.post("/api/link/create",e)}function q(e){return F.post("/api/link/update",e)}function P(e){return F.post("/api/link/delete",e)}const R=f.TextArea;function U(e){const[o]=r.useForm(),[h,n]=c.exports.useState(!1);async function m(){o.validate().then(async i=>{n(!0);try{const s={...i,icon:i.icon&&i.icon.length!==0?i.icon[0].response.data.name:void 0,detail_images:i.detail_images&&i.detail_images.length!==0?JSON.stringify(i.detail_images.map(u=>u.response.data.name)):void 0,status:i.status?"true":"false",sort_index:i.sort_index===0?void 0:i.sort_index};let a;e.data?a=await q({...s,uuid:e.data.uuid}):a=await j(s),a.code===0&&(e.reload(),e.close())}finally{n(!1)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return c.exports.useEffect(()=>{if(e.data){const i=L(e.data),s=i.icon;o.setFieldsValue({...i,icon:i.icon?[{uid:i.icon,url:s,response:{data:{name:i.icon.replace("/media/image?n=",""),path:i.icon}}}]:[],sort_index:i.sort_index===0?void 0:i.sort_index})}},[e.data]),c.exports.useEffect(()=>{e.visible===!1&&o.resetFields()},[o,e.visible]),t(g,{title:e.data?"\u4FEE\u6539\u53CB\u94FE":"\u521B\u5EFA\u53CB\u94FE",extra:t(C,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[t(d,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),t(d,{type:"primary",loading:h,onClick:m,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:p(r,{form:o,labelCol:{span:2},wrapperCol:{span:22},children:[t(r.Item,{label:"\u53CB\u94FE\u540D\u79F0",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u53CB\u94FE\u540D\u79F0"}],children:t(f,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u53CB\u94FE\u540D\u79F0"})}),t(r.Item,{label:"\u53CB\u94FElogo",field:"icon",triggerPropName:"fileList",children:t(y,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(r.Item,{label:"\u53CB\u94FE\u5730\u5740",field:"url",children:t(f,{maxLength:200,placeholder:"\u53CB\u94FE\u5730\u5740"})}),t(r.Item,{label:"\u8DF3\u8F6C\u65B9\u5F0F",field:"target",initialValue:"_blank",children:t(w,{options:e.target})}),t(r.Item,{label:"\u53CB\u94FE\u63CF\u8FF0",field:"description",children:t(R,{maxLength:200,placeholder:"\u53CB\u94FE\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(r.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},children:t(x,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u6392\u5E8F"})}),t(r.Item,{label:"\u542F\u7528\u72B6\u6001",field:"status",triggerPropName:"checked",initialValue:!1,children:t(B,{})})]})})}function te(){const e=c.exports.useRef(),[o,h]=c.exports.useState([]),[n,m]=v({visible:!1,close:function(){m(a=>{a.visible=!1})}});async function i(a){try{const u=await T({uuid:a});u.code===0&&m(l=>{l.data=u.data,l.visible=!0})}catch{}}c.exports.useEffect(()=>{D().then(a=>{const u=[];for(const l in a.data)u.push({value:l,label:a.data[l]});h(u)})},[]);const s=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u540D\u5B57",dataIndex:"name",ellipsis:!0},{title:"logo",width:150,dataIndex:"icon",render:(a,u)=>{if(u.icon){let l="";return l=u.icon,t(S,{width:40,height:40,src:l})}else return"\u6682\u65E0logo"}},{title:"\u7F51\u5740",dataIndex:"url"},{title:"\u5F52\u7C7B",dataIndex:"group"},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"updated_at"},{title:"\u64CD\u4F5C",width:280,render:(a,u)=>p(k,{children:[p(d,{type:"text",onClick:()=>i(u.uuid),children:[t(b,{}),"\u7F16\u8F91"]}),t(_,{reqDel:P,params:{uuid:u.uuid},reload:()=>e.current.reload(),children:p(d,{type:"text",children:[t(A,{}),"\u5220\u9664"]})})]})}];return p(E,{children:[n.visible&&t(U,{visible:n.visible,data:n.data,close:()=>n.close(),reload:()=>e.current.reload(),target:o}),t(g,{style:{display:n.visible?"none":void 0},children:t(I,{ref:e,request:N,columns:s,actionBarRender:[t(d,{type:"primary",onClick:()=>e.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[t(d,{type:"primary",onClick:()=>{m(a=>{a.visible=!0,a.data=void 0})},children:"\u521B\u5EFA\u53CB\u94FE"},"create")]})})]})}export{te as default};
