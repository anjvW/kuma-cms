import{a5 as n,al as a,r as c,j as u,F as m,M as _,a as b,aB as y,an as L,aC as D,ao as h}from"./index.fb3b045d.js";import{S as I,U as j,M as p,c as M}from"./index.058d1b43.js";import"./index.ef35ada2.js";import"./index.96cd2cf9.js";const{Row:S,Col:s}=L,k=n.TextArea;function N(e){const[l]=a.useForm(),[f,v]=c.exports.useState(""),[B,g]=c.exports.useState(!1);c.exports.useEffect(()=>{if(e.uuid&&!e.loading){const{title:i,author:t,source:d,description:o,is_publish:E,cover_pic:r,file_url:F}=e.detail;l.setFieldsValue({title:i,author:t,source:d,description:o,is_publish:E,cover_pic:[{uid:r,url:F,response:{data:{image:{gid:r}}}}]})}},[e.uuid,e.loading]),c.exports.useEffect(()=>{e.visible===!1&&l.resetFields()},[e.visible]);function x(i){v(i)}async function w(i){g(!0);try{const t=await M(i);if(t.code===0)h.success("\u7F16\u8F91\u6210\u529F"),e.close(),e.tableResert();else throw new Error(t.message)}catch(t){h.error(t.message)}g(!1)}async function A(){l.validate().then(()=>{try{if(f==="<p><br></p>")throw new Error("\u8BF7\u586B\u5199\u5C97\u4F4D\u9700\u6C42");const{title:i,author:t,source:d,description:o,is_publish:E,cover_pic:r,cid:F}=l.getFieldsValue();let C;try{D(r)&&(C=r[0].response.data.image.gid)}catch{throw new Error("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25,\u8BF7\u91CD\u65B0\u4E0A\u4F20")}w({uuid:e.uuid,title:i,author:t,source:d,description:o,cid:F,cover_pic:C,content:f})}catch(i){h.error(i.message)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return u(m,{children:u(_,{title:e.uuid?"\u4FEE\u6539\u6587\u7AE0":"\u521B\u5EFA\u6587\u7AE0",style:{width:"60%",maxHeight:"90%",overflow:"scroll"},visible:e.visible,maskClosable:!1,onCancel:()=>e.close(),okText:e.uuid?"\u4FEE\u6539":"\u521B\u5EFA",confirmLoading:B,onOk:A,children:e.loading?u(I,{text:{rows:10}}):b(m,{children:[u(a,{form:l,children:b(S,{children:[u(s,{span:12,children:u(a.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:u(n,{maxLength:200,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})})}),u(s,{span:12,children:u(a.Item,{label:"\u4F5C\u8005",field:"author",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F5C\u8005"}],children:u(n,{maxLength:20,placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"})})}),u(s,{span:12,children:u(a.Item,{label:"\u6765\u6E90",field:"source",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6765\u6E90"}],children:u(n,{maxLength:50,placeholder:"\u8BF7\u8F93\u5165\u6765\u6E90"})})}),u(s,{span:12,children:u(a.Item,{label:"\u63CF\u8FF0",field:"description",children:u(k,{maxLength:200,placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0",autoSize:!0})})}),u(s,{span:24,children:e.visible&&u(a.Item,{labelCol:{span:3,offset:1},label:"\u6587\u7AE0\u5C01\u9762",field:"cover_pic",rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5C01\u9762\u56FE"}],children:u(j,{defaultFileList:e.uuid?[{uid:e.detail.cover_pic,url:e.detail.file_url}]:void 0,action:"/api/upload/image",imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})})})]})}),u(y,{orientation:"left",children:"\u6B63\u6587"}),e.visible&&u(m,{children:u(p,{html:e.uuid?e.detail.content:"",getNewHtml:x})})]})})})}export{N as default};
