import{au as v,at as s,r as m,a as p,j as e,H as A,B as g,bb as x,an as S,ba as L,M as O,F as T,bc as N}from"./index.d7da5add.js";import{T as _}from"./index.e049f78f.js";import{U as b,I as P}from"./index.0d353d2a.js";import{C as D}from"./index.bfb3086e.js";import{T as j,P as q}from"./index.e01d1b69.js";import{b as k,u as M,e as J,p as R,f as U,g as W,r as z,h as H}from"./index.0b906b70.js";import{i as G,C as V,D as K}from"./use-immer.module.58dd9b11.js";import"./index.a68f64a6.js";import{M as Q}from"./index.6a4879ca.js";import{c as w}from"./convertNullToUndefined.a19d8223.js";import{I as X}from"./image.22b6a232.js";import{I as Y}from"./index.ccdb172a.js";import{I as Z}from"./index.9fa425d5.js";import"./index.08b14342.js";import"./index.d1d405b6.js";import"./index.7c59ebec.js";import"./index.c9b1fb52.js";const I=v.TextArea;function $(t){const[h]=s.useForm(),[f,d]=m.exports.useState(""),[C,E]=m.exports.useState(!1),[y,B]=m.exports.useState([]);async function n(){try{const a=await k();if(a.code===0){const r=a.data.pageData,c=new Map,i=[];r.forEach(o=>c.set(o.id,{...o,children:[]})),r.forEach(o=>{const F=c.get(o.pid);F?F.children.push(c.get(o.id)):i.push(c.get(o.id))}),B(i)}}catch{}}function u(a){d(a)}async function l(){h.validate().then(async a=>{E(!0);const r=w(a);try{if(!f||f==="<p><br></p>")throw O.error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9"),new Error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9");const c={...r,cover_image:r.cover_image&&r.cover_image.length!==0?r.cover_image[0].response.data.name:void 0,detail_images:r.detail_images&&r.detail_images.length!==0?JSON.stringify(r.detail_images.map(o=>o.response.data.name)):void 0,status:r.status?"true":"false",description:f,sort_index:r.sort_index===0?void 0:r.sort_index};let i;t.data?i=await M({...c,uuid:t.data.uuid}):i=await J(c),i.code===0&&(t.reload(),t.close())}finally{E(!1)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return m.exports.useEffect(()=>{n()},[]),m.exports.useEffect(()=>{if(t.data){const a=w(t.data),r=a.cover_image;h.setFieldsValue({...a,status:a.status===1,cover_image:a.cover_image?[{uid:a.cover_image,url:r,response:{data:{name:a.cover_image.replace("/media/image?n=",""),path:a.cover_image}}}]:[],detail_images:JSON.parse(a.detail_images).map((c,i)=>({uid:i,url:c,response:{data:{name:c.replace("/media/image?n=",""),path:c}}}))}),d(t.data.description)}},[t.data]),m.exports.useEffect(()=>{t.visible===!1&&h.resetFields()},[h,t.visible]),p(D,{title:t.data?"\u4FEE\u6539\u4EA7\u54C1":"\u521B\u5EFA\u4EA7\u54C1",extra:e(A,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[e(g,{type:"default",onClick:()=>t.close(),children:"\u53D6\u6D88"},"cancel"),e(g,{type:"primary",loading:C,onClick:l,children:t.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:[p(s,{form:h,labelCol:{span:2},wrapperCol:{span:22},children:[e(s.Item,{label:"\u4EA7\u54C1\u540D\u79F0",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u540D\u79F0"}],children:e(v,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u540D\u79F0"})}),e(s.Item,{label:"\u5206\u7C7B",field:"cid",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B"}],wrapperCol:{span:2},children:e(j,{treeData:y,fieldNames:{key:"id",title:"name"},allowClear:!0})}),e(s.Item,{label:"\u6587\u7AE0\u5C01\u9762",field:"cover_image",triggerPropName:"fileList",children:e(b,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(s.Item,{label:"\u4EA7\u54C1\u56FE\u7247",field:"detail_images",triggerPropName:"fileList",children:e(b,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card"})}),e(s.Item,{label:"SEO\u6807\u9898",field:"seo_title",children:e(v,{maxLength:200,showWordLimit:!0,placeholder:"SEO\u6807\u9898"})}),e(s.Item,{label:"SEO\u63CF\u8FF0",field:"seo_desc",children:e(I,{maxLength:200,placeholder:"SEO\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(s.Item,{label:"SEO\u5173\u952E\u8BCD",field:"seo_keywords",children:e(I,{maxLength:200,placeholder:"SEO\u5173\u952E\u8BCD",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(s.Item,{label:"\u4EF7\u683C",field:"price",wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,placeholder:"\u4EF7\u683C",precision:2})}),e(s.Item,{label:"\u5E93\u5B58",field:"stock_quantity",wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u5E93\u5B58"})}),e(s.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},children:e(x,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u6392\u5E8F"})}),e(s.Item,{label:"\u4E0A\u67B6\u72B6\u6001",field:"status",triggerPropName:"checked",children:e(S,{})})]}),e(L,{orientation:"left",children:"\u4EA7\u54C1\u63CF\u8FF0"}),e(Q,{html:f,getContent:u})]})}function Ce(){const t=m.exports.useRef(),[h,f]=m.exports.useState([]),[d,C]=G({visible:!1,close:function(){C(n=>{n.visible=!1})}});async function E(n){const l=(await k()).data.pageData,a=new Map,r=[];return l.forEach(i=>a.set(i.id,{...i,children:[]})),l.forEach(i=>{const o=a.get(i.pid);o?o.children.push(a.get(i.id)):r.push(a.get(i.id))}),f(r),n.map(i=>{const o=l.find(F=>F.id===i.cid);return{...i,category:o?o.name:null}})}async function y(n){try{const u=await H({uuid:n});u.code===0&&C(l=>{l.data=u.data,l.visible=!0})}catch{}}const B=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u5206\u7C7B",dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:h,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:"\u6807\u9898",dataIndex:"name",ellipsis:!0},{title:"\u5C01\u9762\u56FE\u7247",width:150,dataIndex:"cover_image",render:(n,u)=>{if(u.cover_image){let l="";return l=u.cover_image,e(X,{width:40,height:40,src:l})}else return"\u6682\u65E0\u5C01\u9762"}},{title:"\u5206\u7C7B",dataIndex:"category"},{title:"\u4EF7\u683C",dataIndex:"price"},{title:"\u5E93\u5B58",dataIndex:"stock_quantity"},{title:"\u6D4F\u89C8\u91CF",dataIndex:"view_count"},{title:"\u4E0A\u67B6\u72B6\u6001",dataIndex:"is_published",render(n,u){return u.status===1?e(_,{color:"green",children:"\u5DF2\u4E0A\u67B6"}):e(_,{color:"red",children:"\u5DF2\u4E0B\u67B6"})}},{title:"\u66F4\u65B0\u65F6\u95F4",width:180,dataIndex:"updated_at"},{title:"\u64CD\u4F5C",width:280,render:(n,u)=>p(V,{children:[p(g,{type:"text",onClick:()=>y(u.uuid),children:[e(N,{}),"\u7F16\u8F91"]}),u.status===0?p(g,{type:"text",onClick:async()=>{(await U(u.uuid)).code===0&&t.current.reload()},children:[e(P,{}),"\u4E0A\u67B6"]}):p(g,{type:"text",onClick:async()=>{(await W(u.uuid)).code===0&&t.current.reload()},children:[e(Y,{}),"\u4E0B\u67B6"]}),e(K,{reqDel:z,params:{uuid:u.uuid},reload:()=>t.current.reload(),children:p(g,{type:"text",children:[e(Z,{}),"\u5220\u9664"]})})]})}];return p(T,{children:[d.visible&&e($,{visible:d.visible,data:d.data,close:()=>d.close(),reload:()=>t.current.reload()}),e(D,{style:{display:d.visible?"none":void 0},children:e(q,{ref:t,request:R,columns:B,dataRender:E,actionBarRender:[e(g,{type:"primary",onClick:()=>t.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[e(g,{type:"primary",onClick:()=>{C(n=>{n.visible=!0,n.data=void 0})},children:"\u521B\u5EFA\u4EA7\u54C1"},"create")]})})]})}export{Ce as default};
