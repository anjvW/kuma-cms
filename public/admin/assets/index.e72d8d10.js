import{e as O,r as p,f as L,j as e,_,h as g,au as c,at as i,H as S,B as m,a as f,F as y,bd as j,bf as E,bg as k,ab as A,ac as N,M as P,bc as W}from"./index.2fe2a2a6.js";import{T as v}from"./index.5a9ae908.js";import{C as D}from"./index.5fa02b24.js";import{D as z,P as R}from"./index.dcc61214.js";import{i as q,C as J,D as T}from"./use-immer.module.9023b942.js";import{I as U,a as Z}from"./index.b99af012.js";import{A as w}from"./index.46eb08a9.js";import"./index.9b10acf8.js";import{c as $}from"./convertNullToUndefined.a19d8223.js";import{f as M}from"./formatDate.c584a859.js";import{I as H}from"./index.d0e2c697.js";import"./index.fa814d27.js";import"./index.a5655dcc.js";function b(t,r){var u=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),u.push.apply(u,s)}return u}function I(t){for(var r=1;r<arguments.length;r++){var u=arguments[r]!=null?arguments[r]:{};r%2?b(Object(u),!0).forEach(function(s){_(t,s,u[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(u)):b(Object(u)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(u,s))})}return t}function V(t,r){var u=p.exports.useContext(L),s=u.prefixCls,o=s===void 0?"arco":s,l=t.spin,n=t.className,a=I(I({"aria-hidden":!0,focusable:!1,ref:r},t),{},{className:"".concat(n?n+" ":"").concat(o,"-icon ").concat(o,"-icon-user-add")});return l&&(a.className="".concat(a.className," ").concat(o,"-icon-loading")),delete a.spin,delete a.isIcon,e("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...a,children:e("path",{d:"M25 27h-8c-5.523 0-10 4.477-10 10v4h18m11-14v8m0 0v8m0-8h8m-8 0h-8m3-21a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"})})}var B=O.forwardRef(V);B.defaultProps={isIcon:!0};B.displayName="IconUserAdd";var G=B;function K(t){return g.post("/api/leads/query",t)}function Q(t){return g.post("/api/leads/detail",t)}function X(t){return g.post("/api/leads/delete",t)}function Y(){return g.post("/api/leads/group/query")}function ee(){return g.post("/api/leads/status/query")}const te=c.TextArea,{Option:F}=w;function ae(t){var l,n;const[r]=i.useForm(),[u,s]=p.exports.useState(!1);async function o(){r.validate().then(async a=>{console.log(a)}).catch(a=>{if(a.errors)for(const h in a.errors)P.error(a.errors[h].message)})}return p.exports.useEffect(()=>{if(t.data){const a=$(t.data);r.setFieldsValue({...a,assigned_at:a.assigned_at?M(new Date(a.assigned_at)):void 0,tags:a.tags&&Array.isArray(JSON.parse(a.tags))?JSON.parse(a.tags):[]})}},[t.data]),p.exports.useEffect(()=>{t.visible===!1&&r.resetFields()},[r,t.visible]),e(D,{title:t.data?"\u4FEE\u6539\u7EBF\u7D22":"\u521B\u5EFA\u7EBF\u7D22",extra:e(S,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[e(m,{type:"default",onClick:()=>t.close(),children:"\u53D6\u6D88"},"cancel"),e(m,{type:"primary",loading:u,onClick:o,children:t.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:f(i,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[e(i.Item,{label:"\u516C\u53F8",field:"company",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u516C\u53F8"})}),e(i.Item,{label:"\u540D\u5B57",field:"name",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u540D\u5B57"})}),e(i.Item,{label:"\u624B\u673A\u53F7",field:"phone",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u624B\u673A\u53F7"})}),e(i.Item,{label:"\u90AE\u7BB1",field:"email",rules:[{validator(a,h){a&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a)&&h("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E")}}],children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u90AE\u7BB1"})}),e(i.Item,{label:"\u5206\u914D\u4EBA",field:"assigned_to",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u5206\u914D\u4EBA"})}),e(i.Item,{label:"\u5206\u914D\u65F6\u95F4",field:"assigned_at",wrapperCol:{span:2},children:e(z,{})}),e(i.Item,{label:"\u6765\u6E90",field:"source",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u6765\u6E90"})}),e(i.Item,{label:"\u6807\u7B7E",field:"tags",children:e(U,{allowClear:!0,placeholder:"Input and press Enter"})}),e(i.Item,{label:"\u6CE8\u518C\u6761\u76EE",field:"registration_entry",children:e(c,{maxLength:100,showWordLimit:!0,placeholder:"\u6807\u7B7E"})}),e(i.Item,{label:"\u5206\u7EC4",field:"group",wrapperCol:{span:2},children:e(w,{placeholder:"\u9009\u62E9\u5206\u7EC4",children:(l=t.group)==null?void 0:l.map(a=>e(F,{value:a,children:a},a))})}),e(i.Item,{label:"\u5907\u6CE8",field:"description",children:e(te,{maxLength:200,placeholder:"\u5907\u6CE8",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(i.Item,{label:"\u72B6\u6001",field:"status",wrapperCol:{span:2},children:e(Z,{placeholder:"\u9009\u62E9\u72B6\u6001",allowClear:!0,children:(n=t.status)==null?void 0:n.map(a=>e(F,{value:a,children:a},a))})}),e(i.Item,{label:"\u8FFD\u52A0\u4EBA",field:"additional_contacts",children:e(re,{})})]})})}function re(t){const[r,u]=p.exports.useState([]),[s,o]=p.exports.useState(!1),[l,n]=p.exports.useState(!1),[a]=i.useForm();function h(){a.validate().then(d=>{u([...r,d]),o(!1)})}function C(d){u([...r].filter(x=>x.name!==d.name))}return p.exports.useEffect(()=>{t.onChange(JSON.stringify(r))},[r]),p.exports.useEffect(()=>{t.value&&Array.isArray(JSON.parse(t.value))&&u(JSON.parse(t.value))},[t.value]),f(y,{children:[e(j,{width:400,visible:s,onOk:h,onCancel:()=>o(!1),confirmLoading:l,children:f(i,{labelCol:{span:6},wrapperCol:{span:18},form:a,children:[e(i.Item,{label:"\u540D\u5B57",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u5B57"}],children:e(c,{prefix:e(E,{}),placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D\u79F0"})}),e(i.Item,{label:"\u624B\u673A\u53F7",field:"phone",children:e(c,{prefix:e(E,{}),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"})}),e(i.Item,{label:"\u90AE\u7BB1",field:"email",rules:[{validator(d,x){d&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(d)&&x("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E")}}],children:e(c,{prefix:e(k,{}),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1"})})]})}),f(A,{children:[r==null?void 0:r.map(d=>e(N,{title:d.name,content:f("span",{children:[f("p",{children:["\u624B\u673A:",d.phone]}),f("p",{children:["\u90AE\u7BB1:",d.email]})]}),children:e(v,{closable:!0,onClose:()=>C(d),children:d.name})},d.name)),e(m,{children:e(G,{onClick:()=>o(!0)})})]})]})}function Be(){const t=p.exports.useRef(),[r,u]=q({visible:!1,close:function(){u(l=>{l.visible=!1})},group:[],status:[]});p.exports.useEffect(()=>{Y().then(l=>{l.code===0&&u(n=>{n.group=l.data||[]})}),ee().then(l=>{l.code===0&&u(n=>{n.status=l.data||[]})})},[]);async function s(l){try{const n=await Q({uuid:l});n.code===0&&u(a=>{a.data=n.data,a.visible=!0})}catch{}}const o=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u516C\u53F8",dataIndex:"company",ellipsis:!0},{title:"\u540D\u5B57",dataIndex:"name"},{title:"\u624B\u673A",dataIndex:"pho"},{title:"\u90AE\u7BB1",dataIndex:"email"},{title:"\u5206\u914D\u4EBA",dataIndex:"assigned_to"},{title:"\u5206\u914D\u65F6\u95F4",dataIndex:"assigned_at",sorter:!0},{title:"\u6765\u6E90",dataIndex:"source"},{title:"\u6807\u7B7E",dataIndex:"tags",render(l,n){if(n.tags&&typeof JSON.parse(n.tags)=="object")return e(A,{children:JSON.parse(n.tags).map(a=>e(v,{children:a},a))})}},{title:"\u6CE8\u518C\u6761\u76EE",dataIndex:"registration_entry"},{title:"\u5206\u7EC4",dataIndex:"group"},{title:"\u5907\u6CE8",dataIndex:"remark"},{title:"\u72B6\u6001",dataIndex:"status"},{title:"\u64CD\u4F5C",width:280,fixed:"right",render:(l,n)=>f(J,{children:[f(m,{type:"text",onClick:()=>s(n.uuid),children:[e(W,{}),"\u7F16\u8F91"]}),e(T,{reqDel:X,params:{uuid:n.uuid},reload:()=>t.current.reload(),children:f(m,{type:"text",children:[e(H,{}),"\u5220\u9664"]})})]})}];return f(y,{children:[r.visible&&e(ae,{visible:r.visible,data:r.data,close:()=>r.close(),reload:()=>t.current.reload(),group:r.group,status:r.status}),e(D,{style:{display:r.visible?"none":void 0},children:e(R,{ref:t,request:K,columns:o,scroll:{x:2500},actionBarRender:[e(m,{type:"primary",onClick:()=>t.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[e(m,{type:"primary",onClick:()=>{u(l=>{l.visible=!0,l.data=void 0})},children:"\u521B\u5EFA\u7EBF\u7D22"},"create")]})})]})}export{Be as default};
