import{h as s,ae as f,au as o,r as m,j as t,H as g,B as n,a as d,M as F,F as C,b3 as y}from"./index.188c659e.js";import{U as w}from"./index.70fcbb7c.js";import{C as h}from"./index.ea63e9e0.js";import{D as x,P as D}from"./index.c60e1788.js";import{i as b,C as E,D as I}from"./use-immer.module.c8f4966b.js";import"./index.9bf47861.js";import{c as v}from"./convertNullToUndefined.a19d8223.js";import{f as B}from"./formatDate.c584a859.js";import{I as k}from"./image.626e4802.js";import{I as _}from"./index.a9942bd1.js";import"./index.1a62b8c4.js";import"./index.464caf9a.js";import"./index.a79d7306.js";import"./index.703147ed.js";import"./index.22219daf.js";function A(e){return s.post("/api/honor/query",e)}function L(e){return s.post("/api/honor/detail",e)}function j(e){return s.post("/api/honor/create",e)}function q(e){return s.post("/api/honor/update",e)}function P(e){return s.post("/api/honor/delete",e)}const S=f.TextArea;function T(e){const[r]=o.useForm(),[l,c]=m.exports.useState(!1);async function p(){r.validate().then(async a=>{c(!0);try{const i={...a,image:a.image&&a.image.length!==0?a.image[0].response.data.name:void 0};let u;e.data?u=await q({...i,uuid:e.data.uuid}):u=await j(i),u.code===0&&(e.reload(),e.close())}finally{c(!1)}}).catch(a=>{if(a.errors)for(const i in a.errors)F.error(a.errors[i].message)})}return m.exports.useEffect(()=>{if(e.data){const a=v(e.data),i=a.image;r.setFieldsValue({...a,image:a.image?[{uid:a.image,url:i,response:{data:{name:a.image.replace("/media/image?n=",""),path:a.image}}}]:[],award_date:a.award_date?B(new Date(a.award_date)):void 0})}},[e.data]),m.exports.useEffect(()=>{e.visible===!1&&r.resetFields()},[r,e.visible]),t(h,{title:e.data?"\u4FEE\u6539\u8363\u8A89":"\u521B\u5EFA\u8363\u8A89",extra:t(g,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[t(n,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),t(n,{type:"primary",loading:l,onClick:p,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:d(o,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[t(o.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:t(f,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),t(o.Item,{label:"\u56FE\u7247",field:"image",triggerPropName:"fileList",children:t(w,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(o.Item,{label:"\u9881\u53D1\u7EC4\u7EC7",field:"award_organization",wrapperCol:{span:2},children:t(f,{maxLength:100,placeholder:"\u9881\u53D1\u7EC4\u7EC7"})}),t(o.Item,{label:"\u9881\u53D1\u65F6\u95F4",field:"award_date",wrapperCol:{span:2},children:t(x,{})}),t(o.Item,{label:"\u63CF\u8FF0",field:"description",children:t(S,{maxLength:200,placeholder:"\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function Z(){const e=m.exports.useRef(),[r,l]=b({visible:!1,close:function(){l(a=>{a.visible=!1})}});async function c(a){try{const i=await L({uuid:a});i.code===0&&l(u=>{u.data=i.data,u.visible=!0})}catch{}}const p=[{title:"\u5173\u952E\u8BCD",dataIndex:"keyword",search:!0,hide:!0},{title:"\u6807\u9898",dataIndex:"title",ellipsis:!0},{title:"\u56FE\u7247",width:150,dataIndex:"image",render:(a,i)=>{if(i.image){let u="";return u=i.image,t(k,{width:40,height:40,src:u})}else return"\u6682\u65E0\u56FE\u7247"}},{title:"\u9881\u53D1\u7EC4\u7EC7",dataIndex:"award_organization"},{title:"\u9881\u53D1\u65F6\u95F4",dataIndex:"award_date"},{title:"\u64CD\u4F5C",width:280,render:(a,i)=>d(E,{children:[d(n,{type:"text",onClick:()=>c(i.uuid),children:[t(y,{}),"\u7F16\u8F91"]}),t(I,{reqDel:P,params:{uuid:i.uuid},reload:()=>e.current.reload(),children:d(n,{type:"text",children:[t(_,{}),"\u5220\u9664"]})})]})}];return d(C,{children:[r.visible&&t(T,{visible:r.visible,data:r.data,close:()=>r.close(),reload:()=>e.current.reload()}),t(h,{style:{display:r.visible?"none":void 0},children:t(D,{ref:e,request:A,columns:p,actionBarRender:[t(n,{type:"primary",onClick:()=>e.current.reload(),children:"\u5237\u65B0"},"refresh")],toolBarRender:[t(n,{type:"primary",onClick:()=>{l(a=>{a.visible=!0,a.data=void 0})},children:"\u6DFB\u52A0\u8363\u8A89\u8D44\u8D28"},"create")]})})]})}export{Z as default};
